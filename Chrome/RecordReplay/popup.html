<!DOCTYPE html>
<html>
  <body>
    <button id="startRecord">Start Recording</button>
    <button id="stopRecord">Stop Recording</button>
    <input type="file" id="upload" accept=".json" style="display:none;">
    <button id="replay">Upload & Replay Recording</button>
    <script>
      document.getElementById('startRecord').addEventListener('click', () => {
        chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {
          chrome.tabs.sendMessage(tabs[0].id, {action: 'startRecording'});
        });
      });

      document.getElementById('stopRecord').addEventListener('click', () => {
        chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {
          chrome.tabs.sendMessage(tabs[0].id, {action: 'stopRecording'});
        });
      });

      document.getElementById('replay').addEventListener('click', () => {
        document.getElementById('upload').click();
      });

      document.getElementById('upload').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (evt) => {
            const sequence = JSON.parse(evt.target.result);
            chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {
              chrome.tabs.sendMessage(tabs[0].id, {action: 'replay', sequence});
            });
          };
          reader.readAsText(file);
        }
      });
    </script>
  </body>
</html>